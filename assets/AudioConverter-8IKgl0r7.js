var q=Object.defineProperty;var _=t=>{throw TypeError(t)};var z=(t,e,s)=>e in t?q(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var l=(t,e,s)=>z(t,typeof e!="symbol"?e+"":e,s),U=(t,e,s)=>e.has(t)||_("Cannot "+s);var a=(t,e,s)=>(U(t,e,"read from private field"),s?s.call(t):e.get(t)),w=(t,e,s)=>e.has(t)?_("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),I=(t,e,s,n)=>(U(t,e,"write to private field"),n?n.call(t,s):e.set(t,s),s);import{c as J,r as m,j as r,L as B}from"./index-DrWj1tgA.js";import{U as Q}from"./upload-C3dpc3Xt.js";import{A as Z}from"./alert-circle-CB5MyUBg.js";import{D as ee}from"./download-DZ1EfTSG.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=J("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]);var o;(function(t){t.LOAD="LOAD",t.EXEC="EXEC",t.FFPROBE="FFPROBE",t.WRITE_FILE="WRITE_FILE",t.READ_FILE="READ_FILE",t.DELETE_FILE="DELETE_FILE",t.RENAME="RENAME",t.CREATE_DIR="CREATE_DIR",t.LIST_DIR="LIST_DIR",t.DELETE_DIR="DELETE_DIR",t.ERROR="ERROR",t.DOWNLOAD="DOWNLOAD",t.PROGRESS="PROGRESS",t.LOG="LOG",t.MOUNT="MOUNT",t.UNMOUNT="UNMOUNT"})(o||(o={}));const se=(()=>{let t=0;return()=>t++})(),re=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),ae=new Error("called FFmpeg.terminate()");var f,N,b,L,j,A,c;class ne{constructor(){w(this,f,null);w(this,N,{});w(this,b,{});w(this,L,[]);w(this,j,[]);l(this,"loaded",!1);w(this,A,()=>{a(this,f)&&(a(this,f).onmessage=({data:{id:e,type:s,data:n}})=>{switch(s){case o.LOAD:this.loaded=!0,a(this,N)[e](n);break;case o.MOUNT:case o.UNMOUNT:case o.EXEC:case o.FFPROBE:case o.WRITE_FILE:case o.READ_FILE:case o.DELETE_FILE:case o.RENAME:case o.CREATE_DIR:case o.LIST_DIR:case o.DELETE_DIR:a(this,N)[e](n);break;case o.LOG:a(this,L).forEach(i=>i(n));break;case o.PROGRESS:a(this,j).forEach(i=>i(n));break;case o.ERROR:a(this,b)[e](n);break}delete a(this,N)[e],delete a(this,b)[e]})});w(this,c,({type:e,data:s},n=[],i)=>a(this,f)?new Promise((u,p)=>{const h=se();a(this,f)&&a(this,f).postMessage({id:h,type:e,data:s},n),a(this,N)[h]=u,a(this,b)[h]=p,i==null||i.addEventListener("abort",()=>{p(new DOMException(`Message # ${h} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(re));l(this,"load",({classWorkerURL:e,...s}={},{signal:n}={})=>(a(this,f)||(I(this,f,e?new Worker(new URL(e,import.meta.url),{type:"module"}):new Worker(new URL("/assets/worker-BAOIWoxA.js",import.meta.url),{type:"module"})),a(this,A).call(this)),a(this,c).call(this,{type:o.LOAD,data:s},void 0,n)));l(this,"exec",(e,s=-1,{signal:n}={})=>a(this,c).call(this,{type:o.EXEC,data:{args:e,timeout:s}},void 0,n));l(this,"ffprobe",(e,s=-1,{signal:n}={})=>a(this,c).call(this,{type:o.FFPROBE,data:{args:e,timeout:s}},void 0,n));l(this,"terminate",()=>{const e=Object.keys(a(this,b));for(const s of e)a(this,b)[s](ae),delete a(this,b)[s],delete a(this,N)[s];a(this,f)&&(a(this,f).terminate(),I(this,f,null),this.loaded=!1)});l(this,"writeFile",(e,s,{signal:n}={})=>{const i=[];return s instanceof Uint8Array&&i.push(s.buffer),a(this,c).call(this,{type:o.WRITE_FILE,data:{path:e,data:s}},i,n)});l(this,"mount",(e,s,n)=>{const i=[];return a(this,c).call(this,{type:o.MOUNT,data:{fsType:e,options:s,mountPoint:n}},i)});l(this,"unmount",e=>{const s=[];return a(this,c).call(this,{type:o.UNMOUNT,data:{mountPoint:e}},s)});l(this,"readFile",(e,s="binary",{signal:n}={})=>a(this,c).call(this,{type:o.READ_FILE,data:{path:e,encoding:s}},void 0,n));l(this,"deleteFile",(e,{signal:s}={})=>a(this,c).call(this,{type:o.DELETE_FILE,data:{path:e}},void 0,s));l(this,"rename",(e,s,{signal:n}={})=>a(this,c).call(this,{type:o.RENAME,data:{oldPath:e,newPath:s}},void 0,n));l(this,"createDir",(e,{signal:s}={})=>a(this,c).call(this,{type:o.CREATE_DIR,data:{path:e}},void 0,s));l(this,"listDir",(e,{signal:s}={})=>a(this,c).call(this,{type:o.LIST_DIR,data:{path:e}},void 0,s));l(this,"deleteDir",(e,{signal:s}={})=>a(this,c).call(this,{type:o.DELETE_DIR,data:{path:e}},void 0,s))}on(e,s){e==="log"?a(this,L).push(s):e==="progress"&&a(this,j).push(s)}off(e,s){e==="log"?I(this,L,a(this,L).filter(n=>n!==s)):e==="progress"&&I(this,j,a(this,j).filter(n=>n!==s))}}f=new WeakMap,N=new WeakMap,b=new WeakMap,L=new WeakMap,j=new WeakMap,A=new WeakMap,c=new WeakMap;var P;(function(t){t.MEMFS="MEMFS",t.NODEFS="NODEFS",t.NODERAWFS="NODERAWFS",t.IDBFS="IDBFS",t.WORKERFS="WORKERFS",t.PROXYFS="PROXYFS"})(P||(P={}));const oe=new Error("failed to get response body reader"),ie=new Error("failed to complete download"),le="Content-Length",ce=async(t,e)=>{var i;const s=await fetch(t);let n;try{const u=parseInt(s.headers.get(le)||"-1"),p=(i=s.body)==null?void 0:i.getReader();if(!p)throw oe;const h=[];let R=0;for(;;){const{done:g,value:k}=await p.read(),v=k?k.length:0;if(g){if(u!=-1&&u!==R)throw ie;e&&e({url:t,total:u,received:R,delta:v,done:g});break}h.push(k),R+=v,e&&e({url:t,total:u,received:R,delta:v,done:g})}const O=new Uint8Array(R);let D=0;for(const g of h)O.set(g,D),D+=g.length;n=O.buffer}catch(u){console.log("failed to send download progress event: ",u),n=await s.arrayBuffer()}return n},M=async(t,e,s=!1,n)=>{const i=s?await ce(t,n):await(await fetch(t)).arrayBuffer(),u=new Blob([i],{type:e});return URL.createObjectURL(u)};function Ee(){const[t,e]=m.useState(null),[s,n]=m.useState(!1),[i,u]=m.useState(0),[p,h]=m.useState(""),[R,O]=m.useState(null),[D,g]=m.useState("mp3"),[k,v]=m.useState("192k"),[C,W]=m.useState(!1),S=m.useRef(new ne),y=m.useRef(null),T=async()=>{const d="https://unpkg.com/@ffmpeg/core@0.12.6/dist/esm",E=S.current;E.on("progress",({progress:x})=>{u(Math.round(x*100))});try{await E.load({coreURL:await M(`${d}/ffmpeg-core.js`,"text/javascript"),wasmURL:await M(`${d}/ffmpeg-core.wasm`,"application/wasm")}),W(!0)}catch(x){console.error(x),h("Failed to load FFmpeg. Your browser might not support SharedArrayBuffer or blocked the script.")}};m.useEffect(()=>{T()},[]);const F=d=>{var x;const E=(x=d.target.files)==null?void 0:x[0];E&&(e(E),O(null),h(""))},G=async d=>new Uint8Array(await d.arrayBuffer()),X=async()=>{if(!t||!C)return;n(!0),h(""),O(null),u(0);const d=S.current;try{const E="input"+t.name.substring(t.name.lastIndexOf(".")),x=`output.${D}`;await d.writeFile(E,await G(t));const Y={"128k":"128k","192k":"192k","256k":"256k","320k":"320k"};await d.exec(["-i",E,"-b:a",Y[k],x]);const H=await d.readFile(x),K=new Blob([H],{type:`audio/${D}`}),V=URL.createObjectURL(K);O(V)}catch(E){console.error(E),h("Conversion failed. Check console for details.")}finally{n(!1)}},$=()=>{e(null),O(null),h(""),y.current&&(y.current.value="")};return r.jsx("div",{className:"space-y-6",children:r.jsxs("div",{className:"card",children:[r.jsxs("h2",{className:"text-xl font-bold mb-6 flex items-center gap-2",children:[r.jsx(te,{className:"w-6 h-6 text-green-500"}),"Audio Converter (Client-Side)"]}),!C&&!p&&r.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 text-blue-600 rounded-xl flex items-center gap-2 mb-6",children:[r.jsx(B,{className:"w-5 h-5 animate-spin"}),"Loading Audio Processing Engine..."]}),r.jsxs("label",{className:"cursor-pointer block mb-4",children:[r.jsx("input",{ref:y,type:"file",accept:"audio/*",onChange:F,className:"hidden"}),r.jsx("div",{className:"flex items-center justify-center p-8 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-xl hover:border-green-500 transition-colors",children:r.jsxs("div",{className:"text-center",children:[r.jsx(Q,{className:"w-12 h-12 mx-auto mb-4 text-slate-400"}),r.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:t?t.name:"Click to upload audio file"}),r.jsx("p",{className:"text-sm text-slate-500",children:"Supports most audio formats"})]})})]}),t&&r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Output Format"}),r.jsxs("select",{value:D,onChange:d=>g(d.target.value),className:"input-field",children:[r.jsx("option",{value:"mp3",children:"MP3"}),r.jsx("option",{value:"wav",children:"WAV"}),r.jsx("option",{value:"ogg",children:"OGG"}),r.jsx("option",{value:"m4a",children:"M4A"}),r.jsx("option",{value:"aac",children:"AAC"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Bitrate"}),r.jsxs("select",{value:k,onChange:d=>v(d.target.value),className:"input-field",children:[r.jsx("option",{value:"128k",children:"128 kbps"}),r.jsx("option",{value:"192k",children:"192 kbps"}),r.jsx("option",{value:"256k",children:"256 kbps"}),r.jsx("option",{value:"320k",children:"320 kbps"})]})]})]}),r.jsx("button",{onClick:X,disabled:s||!C,className:"btn-primary w-full disabled:opacity-50",children:s?r.jsxs(r.Fragment,{children:[r.jsx(B,{className:"w-5 h-5 animate-spin inline mr-2"}),"Converting... ",i,"%"]}):"Convert Audio"})]}),p&&r.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 p-4 rounded-xl text-red-600 flex items-center gap-2",children:[r.jsx(Z,{className:"w-5 h-5"}),p]}),R&&r.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-xl",children:[r.jsx("p",{className:"text-green-800 dark:text-green-200 mb-2 font-medium",children:"Conversion Successful!"}),r.jsx("audio",{controls:!0,src:R,className:"w-full mb-2"}),r.jsxs("a",{href:R,download:`converted.${D}`,className:"btn-primary inline-flex items-center gap-2",children:[r.jsx(ee,{className:"w-4 h-4"})," Download Converted File"]})]}),t&&r.jsx("button",{onClick:$,className:"btn-secondary w-full mt-4",children:"Clear"})]})})}export{Ee as default};
