import{r as l,j as e,L as K}from"./index-DrWj1tgA.js";import{J as Q}from"./jszip.min-Bi_8JJEF.js";import{E as V}from"./jspdf.es.min-DXNgk7CK.js";import{B as Y}from"./book-D0fH91kY.js";import{U as _}from"./upload-C3dpc3Xt.js";import{A as ee}from"./alert-circle-CB5MyUBg.js";import{D as te}from"./download-DZ1EfTSG.js";function fe(){const[n,R]=l.useState(null),[P,v]=l.useState(!1),[F,x]=l.useState(""),[u,h]=l.useState(null),O=l.useRef(null),T=r=>{var o;const s=(o=r.target.files)==null?void 0:o[0];s&&(R(s),h(null),x(""))},I=async()=>{var r,s,o;if(n){v(!0),x(""),h(null);try{const c=await n.arrayBuffer(),g=await new Q().loadAsync(c),S=await((r=g.file("META-INF/container.xml"))==null?void 0:r.async("text"));if(!S)throw new Error("Invalid EPUB: META-INF/container.xml not found");const b=new DOMParser,N=b.parseFromString(S,"text/xml").querySelector("rootfile"),m=N==null?void 0:N.getAttribute("full-path");if(!m)throw new Error("Invalid EPUB: OPF path not found");const D=await((s=g.file(m))==null?void 0:s.async("text"));if(!D)throw new Error("OPF file not found");const k=b.parseFromString(D,"text/xml"),C=k.getElementsByTagName("manifest")[0],B=k.getElementsByTagName("spine")[0];if(!C||!B)throw new Error("Invalid OPF: Missing manifest or spine");const j={};Array.from(C.getElementsByTagName("item")).forEach(d=>{const a=d.getAttribute("id"),f=d.getAttribute("href");a&&f&&(j[a]=f)});const M=Array.from(B.getElementsByTagName("itemref")),W=m.substring(0,m.lastIndexOf("/")+1),t=new V,i=20,w=t.internal.pageSize.getWidth(),y=t.internal.pageSize.getHeight(),H=w-i*2;let A=!0;t.setFontSize(11);for(const d of M){const a=d.getAttribute("idref");if(!a||!j[a])continue;const f=j[a],E=W+f,$=E.startsWith("./")?E.slice(2):E,U=await((o=g.file($))==null?void 0:o.async("text"));if(U){const z=b.parseFromString(U,"text/html").body.textContent||"";if(z.trim().length>0){A||t.addPage(),A=!1;const J=t.getNumberOfPages();t.setFontSize(9),t.text(`Page ${J}`,w/2,y-10,{align:"center"}),t.setFontSize(11);const X=t.splitTextToSize(z.trim().replace(/\n\s*\n/g,`

`),H);let p=i;const q=7;X.forEach(Z=>{if(p>y-i-10){t.addPage(),p=i;const G=t.getNumberOfPages();t.setFontSize(9),t.text(`Page ${G}`,w/2,y-10,{align:"center"}),t.setFontSize(11)}t.text(Z,i,p),p+=q})}}}h(t.output("blob"))}catch(c){console.error(c),x(c.message||"Error converting EPUB. File might be protected or invalid.")}finally{v(!1)}}},L=()=>{if(!u)return;const r=URL.createObjectURL(u),s=document.createElement("a");s.href=r,s.download=(n==null?void 0:n.name.replace(/\.epub$/i,""))+".pdf"||"ebook.pdf",s.click(),URL.revokeObjectURL(r)};return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"card",children:[e.jsxs("h2",{className:"text-xl font-bold mb-6 flex items-center gap-2",children:[e.jsx(Y,{className:"w-6 h-6 text-emerald-600"}),"EPUB to PDF Converter"]}),e.jsxs("label",{className:"cursor-pointer block mb-6",children:[e.jsx("input",{ref:O,type:"file",accept:".epub",onChange:T,className:"hidden"}),e.jsx("div",{className:"flex items-center justify-center p-8 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-xl hover:border-emerald-500 transition-colors",children:e.jsxs("div",{className:"text-center",children:[e.jsx(_,{className:"w-12 h-12 mx-auto mb-4 text-slate-400"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:n?n.name:"Click to upload EPUB file"})]})})]}),n&&e.jsx("button",{onClick:I,disabled:P,className:"btn-primary w-full disabled:opacity-50",children:P?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-5 h-5 animate-spin inline mr-2"}),"Converting..."]}):"Convert to PDF"}),F&&e.jsxs("div",{className:"mt-4 flex items-center gap-2 text-red-600 bg-red-50 dark:bg-red-900/20 p-4 rounded-xl",children:[e.jsx(ee,{className:"w-5 h-5"}),F]}),u&&e.jsxs("div",{className:"mt-4 p-4 bg-emerald-50 dark:bg-emerald-900/20 rounded-xl",children:[e.jsx("h3",{className:"text-emerald-800 dark:text-emerald-200 font-medium mb-4",children:"Conversion Success!"}),e.jsxs("button",{onClick:L,className:"btn-primary w-full flex items-center justify-center gap-2",children:[e.jsx(te,{className:"w-5 h-5"}),"Download PDF"]})]}),e.jsxs("div",{className:"mt-6 p-4 bg-slate-50 dark:bg-slate-800 rounded-xl",children:[e.jsx("h3",{className:"font-medium mb-2",children:"About this tool"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Extracts text content from EPUB chapters and generates a PDF. Images and complex formatting may not be preserved in this basic converter. DRM-protected files are not supported."})]})]})})}export{fe as default};
